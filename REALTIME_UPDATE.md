# å®æ—¶å›¾è¡¨æ›´æ–°å®ç°

## âœ… å®ç°å®Œæˆ

### åŠŸèƒ½è¯´æ˜
**Run All Steps æ¨¡å¼**ç°åœ¨æ”¯æŒå®æ—¶å›¾è¡¨æ›´æ–°ï¼åç«¯æ¯å®Œæˆä¸€è½®iterationï¼Œå‰ç«¯ç«‹å³è·å–æ•°æ®å¹¶æ›´æ–°å›¾è¡¨ã€‚

## ğŸ”„ å·¥ä½œåŸç†

### æ¶æ„è®¾è®¡

```
å‰ç«¯ (Frontend)                    åç«¯ (Backend)
    â”‚                                   â”‚
    â”‚  1. POST /api/debias/init         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                   â”‚ åˆ›å»ºjob
    â”‚  2. POST /api/debias/{id}/run-fullâ”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                   â”‚ å¯åŠ¨åå°çº¿ç¨‹
    â”‚  â† ç«‹å³è¿”å› 'started'             â”‚ (ä¸ç­‰å¾…å®Œæˆ)
    â”‚                                   â”‚
    â”‚                                   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                   â”‚ â”‚ çº¿ç¨‹æ‰§è¡Œä¸­   â”‚
    â”‚  3. GET /api/debias/{id}/status   â”‚ â”‚ Iteration 1 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ â”‚ Iteration 2 â”‚
    â”‚  â† history[0..1]                  â”‚ â”‚ Iteration 3 â”‚
    â”‚  æ›´æ–°å›¾è¡¨ (1-2è½®)                  â”‚ â”‚     ...     â”‚
    â”‚                                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  4. GET /api/debias/{id}/status   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  â† history[0..3]                  â”‚
    â”‚  æ›´æ–°å›¾è¡¨ (1-3è½®)                  â”‚
    â”‚                                   â”‚
    â”‚       ... æ¯500msè½®è¯¢ä¸€æ¬¡ ...      â”‚
    â”‚                                   â”‚
    â”‚  N. GET /api/debias/{id}/status   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  â† state='completed'              â”‚
    â”‚  æ˜¾ç¤ºå®Œæˆæç¤º                      â”‚
    â”‚                                   â”‚
```

### åç«¯å®ç°

#### 1. **åå°çº¿ç¨‹æ‰§è¡Œ** (`_run_full_process_thread`)
```python
def _run_full_process_thread(job_id):
    job = jobs[job_id]
    
    while not terminated:
        # æ‰§è¡Œä¸€è½® iteration
        # ...
        
        # å®æ—¶è¿½åŠ åˆ° job['history']
        job['history'].append(iter_data)
        job['progress'] = (current / max) * 100
        
        # ç»§ç»­ä¸‹ä¸€è½®...
```

- åœ¨åå°çº¿ç¨‹ä¸­å¾ªç¯æ‰§è¡Œiterations
- æ¯å®Œæˆä¸€è½®å°±**ç«‹å³**è¿½åŠ åˆ° `job['history']`
- æ›´æ–° `job['progress']` ç™¾åˆ†æ¯”

#### 2. **APIç«¯ç‚¹æ”¹é€ **

**`POST /api/debias/{id}/run-full`** - å¯åŠ¨å¼‚æ­¥æ‰§è¡Œ
```python
# å¯åŠ¨åå°çº¿ç¨‹
thread = threading.Thread(target=_run_full_process_thread, args=(job_id,))
thread.daemon = True
thread.start()

# ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…å®Œæˆ
return jsonify({'status': 'success', 'message': 'Job started'})
```

**`GET /api/debias/{id}/status`** - è·å–å®æ—¶è¿›åº¦
```python
return {
    'state': 'running' | 'completed' | 'failed',
    'current_iteration': 5,
    'max_iteration': 20,
    'progress': 25.0,  # ç™¾åˆ†æ¯”
    'history': [...],  # å·²å®Œæˆçš„iterations
    'terminated': False,
    'termination_reason': None
}
```

### å‰ç«¯å®ç°

#### 1. **å¯åŠ¨æµç¨‹**
```javascript
async function runAllSteps() {
    // åˆå§‹åŒ–job
    await api.initDebias(datasetId);
    
    // å¯åŠ¨åå°æ‰§è¡Œï¼ˆç«‹å³è¿”å›ï¼‰
    await api.runFullProcess(jobId);
    
    // å¼€å§‹è½®è¯¢
    pollJobProgress();
}
```

#### 2. **è½®è¯¢æœºåˆ¶**
```javascript
let pollInterval = setInterval(async () => {
    const status = await api.getJobStatus(jobId);
    
    // æ›´æ–°history
    if (status.data.history.length > state.history.length) {
        state.history = [åˆå§‹å€¼, ...status.data.history];
        
        // å®æ—¶æ›´æ–°å›¾è¡¨ï¼
        showProcessStep(status.data.history.length, true);
    }
    
    // æ£€æŸ¥å®Œæˆ
    if (status.data.state === 'completed') {
        clearInterval(pollInterval);
        alert('å®Œæˆï¼');
    }
}, 500);  // æ¯500msè½®è¯¢ä¸€æ¬¡
```

#### 3. **å›¾è¡¨æ›´æ–°**
- æ¯æ¬¡è½®è¯¢è·å–æ–°çš„ history
- è°ƒç”¨ `showProcessStep()` é‡æ–°æ¸²æŸ“å›¾è¡¨
- å›¾è¡¨æ˜¾ç¤º**æœ€æ–°**çš„fairnesså’Œaccuracyæ•°æ®

## ğŸ“Š ç”¨æˆ·ä½“éªŒ

### Run All Steps æ¨¡å¼ï¼ˆå®æ—¶æ›´æ–°ï¼‰

1. **ç‚¹å‡» "Run"**
   - æŒ‰é’®å˜ä¸º "Running..."
   - çŠ¶æ€æ˜¾ç¤º "Running (0/20)"

2. **åç«¯å¼€å§‹æ‰§è¡Œ**
   - Iteration 1 å®Œæˆ â†’ å‰ç«¯ç«‹å³çœ‹åˆ°ç¬¬1è½®å›¾è¡¨
   - Iteration 2 å®Œæˆ â†’ å›¾è¡¨æ›´æ–°æ˜¾ç¤ºç¬¬2è½®
   - Iteration 3 å®Œæˆ â†’ å›¾è¡¨æ›´æ–°æ˜¾ç¤ºç¬¬3è½®
   - ... å®æ—¶æ›´æ–° ...

3. **è¾¾åˆ°ç»ˆæ­¢æ¡ä»¶**
   - çŠ¶æ€å˜ä¸º "Completed"
   - å¼¹çª—æ˜¾ç¤ºç»ˆæ­¢åŸå› ï¼š
     ```
     Process completed!
     Epsilon threshold reached: 0.000012 <= 0.000044
     Total iterations: 8
     ```

### Step by Step æ¨¡å¼ï¼ˆæ‰‹åŠ¨æ§åˆ¶ï¼‰

- æ¯æ¬¡ç‚¹å‡»æ‰§è¡Œ**ä¸€è½®**å®Œæ•´iteration
- ç«‹å³è¿”å›ç»“æœå¹¶æ›´æ–°å›¾è¡¨
- ç”¨æˆ·å¯ä»¥é€æ­¥è§‚å¯Ÿæ¯è½®çš„å˜åŒ–

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

| ç‰¹æ€§ | æ—§å®ç° | æ–°å®ç° |
|-----|-------|-------|
| **å“åº”æ€§** | ç­‰å¾…æ‰€æœ‰iterationså®Œæˆ | å®æ—¶æ˜¾ç¤ºæ¯ä¸€è½® |
| **ç”¨æˆ·ä½“éªŒ** | å¡é¡¿ï¼Œæ— åé¦ˆ | æµç•…ï¼Œå®æ—¶è¿›åº¦ |
| **å¯ä¸­æ–­** | âŒ æ— æ³•ä¸­æ–­ | âœ… å¯éšæ—¶reset |
| **è¿›åº¦å¯è§** | âŒ é»‘ç›’ | âœ… å®æ—¶ç™¾åˆ†æ¯” |
| **æœåŠ¡å™¨å‹åŠ›** | é•¿æ—¶é—´å ç”¨è¿æ¥ | çŸ­è¯·æ±‚ï¼Œå¼‚æ­¥æ‰§è¡Œ |

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### è½®è¯¢é¢‘ç‡
- **500ms** - å¹³è¡¡å®æ—¶æ€§å’ŒæœåŠ¡å™¨å‹åŠ›
- å¯æ ¹æ®éœ€è¦è°ƒæ•´ï¼ˆæ›´å¿«ï¼š100msï¼Œæ›´æ…¢ï¼š1000msï¼‰

### çº¿ç¨‹å®‰å…¨
- ä½¿ç”¨Pythonçš„ `threading.Thread`
- `daemon=True`ï¼šä¸»è¿›ç¨‹é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†
- `job` å­—å…¸ç”±ä¸»çº¿ç¨‹åˆ›å»ºï¼Œåå°çº¿ç¨‹æ›´æ–°
- Flaskæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ªè¯·æ±‚å¯å¹¶å‘è®¿é—® `jobs` å­—å…¸

### é”™è¯¯å¤„ç†
- åå°çº¿ç¨‹å¼‚å¸¸ â†’ `job['state'] = 'failed'`
- å‰ç«¯æ£€æµ‹åˆ° `failed` â†’ åœæ­¢è½®è¯¢ï¼Œæ˜¾ç¤ºé”™è¯¯

### èµ„æºæ¸…ç†
- ç”¨æˆ·ç‚¹å‡» "Reset" â†’ æ¸…é™¤è½®è¯¢
- é¡µé¢å¸è½½ â†’ è‡ªåŠ¨æ¸…é™¤ `daemon` çº¿ç¨‹
- è½®è¯¢å®Œæˆ â†’ `clearInterval(pollInterval)`

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. å¯åŠ¨åç«¯
```bash
cd backend
conda activate bmwithae
python app.py
```

### 2. æ‰“å¼€å‰ç«¯
- ç”¨Live Serveræ‰“å¼€ `frontend/index.html`
- æˆ–ç›´æ¥ç”¨æµè§ˆå™¨æ‰“å¼€

### 3. è¿è¡Œæµ‹è¯•

**å®æ—¶æ›´æ–°æµ‹è¯•**:
1. Load Creditæ•°æ®
2. æ‰“å¼€å‚æ•°é…ç½®ï¼Œè®¾ç½® `Max Iteration = 20`
3. é€‰æ‹© "Run All Steps"
4. ç‚¹å‡» "Run"
5. **è§‚å¯Ÿå›¾è¡¨å®æ—¶æ›´æ–°ï¼** ğŸ“ˆ

**çŠ¶æ€ç›‘æ§**:
- çŠ¶æ€æ æ˜¾ç¤ºï¼š`Running (5/20)` è¡¨ç¤ºå½“å‰ç¬¬5è½®ï¼Œå…±20è½®
- æ¯å®Œæˆä¸€è½®ï¼Œå›¾è¡¨ç«‹å³æ›´æ–°
- Fairness Metric Evolution å’Œ Trade-off å›¾è¡¨åŠ¨æ€å˜åŒ–

## ğŸ“ é…ç½®å‚æ•°

### å…³é”®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|-------|------|
| `PARAMS_MAIN_MAX_ITERATION` | 20 | æœ€å¤§è¿­ä»£æ¬¡æ•° |
| `PARAMS_MAIN_THRESHOLD_EPSILON` | 0.9 | Epsiloné˜ˆå€¼ï¼ˆåˆå§‹å¹³å‡å€¼çš„å€æ•°ï¼‰|
| `PARAMS_MAIN_THRESHOLD_ACCURACY` | 0.01 | Accuracyé˜ˆå€¼ï¼ˆåˆå§‹å€¼+1%ï¼‰|
| `USE_BIAS_MITIGATION` | True | å¯ç”¨å»å |
| `USE_ACCURACY_ENHANCEMENT` | False | å¯ç”¨å‡†ç¡®æ€§å¢å¼º |

### è°ƒæ•´å»ºè®®

**å¿«é€Ÿæµ‹è¯•**:
```javascript
mainMaxIteration: 5
mainThresholdEpsilon: 0.5  // æ›´å®¹æ˜“è¾¾åˆ°
```

**å®Œæ•´æµ‹è¯•**:
```javascript
mainMaxIteration: 50
mainThresholdEpsilon: 0.9  // æ›´ä¸¥æ ¼
```

## âœ… æµ‹è¯•æ¸…å•

- [x] åç«¯å¼‚æ­¥æ‰§è¡Œ
- [x] å‰ç«¯è½®è¯¢æœºåˆ¶
- [x] å®æ—¶å›¾è¡¨æ›´æ–°
- [x] è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤º
- [x] ç»ˆæ­¢æ¡ä»¶æ£€æµ‹
- [x] é”™è¯¯å¤„ç†
- [x] ResetåŠŸèƒ½
- [ ] å®é™…è¿è¡Œæµ‹è¯•ï¼ˆéœ€è¦ç”¨æˆ·æ‰§è¡Œï¼‰

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ **Run All Steps** æ¨¡å¼çœŸæ­£å®ç°äº†å®æ—¶å›¾è¡¨æ›´æ–°ï¼
- âœ… åç«¯æ¯å®Œæˆä¸€è½®ï¼Œå‰ç«¯ç«‹å³æ›´æ–°
- âœ… ç”¨æˆ·å¯ä»¥å®æ—¶è§‚å¯Ÿå»åè¿‡ç¨‹
- âœ… æµç•…çš„ç”¨æˆ·ä½“éªŒ

**é‡å¯åç«¯ï¼Œåˆ·æ–°å‰ç«¯ï¼Œå¼€å§‹æµ‹è¯•å§ï¼** ğŸš€



